<!DOCTYPE html>
<html lang="uk" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–ë–ö ¬´–•–æ—Ä—ñ—à–∫–∏¬ª ‚Äî –ê—Ñ—ñ—à–∞, –≥—É—Ä—Ç–∫–∏, –∫–æ–Ω—Ç–∞–∫—Ç–∏</title>
  <meta name="description" content="–û—Ñ—ñ—Ü—ñ–π–Ω–∏–π —Å–∞–π—Ç –ë–ö ¬´–•–æ—Ä—ñ—à–∫–∏¬ª. –ê—Ñ—ñ—à–∞ –ø–æ–¥—ñ–π, –≥—É—Ä—Ç–∫–∏, –Ω–æ–≤–∏–Ω–∏, –∫–æ–Ω—Ç–∞–∫—Ç–∏ —Ç–∞ –æ—Ä–µ–Ω–¥–∞ –∑–∞–ª—É.">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#2151d1">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'%3E%3Crect width='128' height='128' rx='22' fill='%232151d1'/%3E%3Ctext x='50%' y='54%' dominant-baseline='middle' text-anchor='middle' font-family='Inter,Arial' font-size='64' fill='white'%3E%D0%94%D0%9A%3C/text%3E%3C/svg%3E">
  <link rel="preconnect" href="https://images.unsplash.com" crossorigin>
  <link rel="preconnect" href="https://docs.google.com" crossorigin>
  <link rel="canonical" href="https://emprex291.github.io/">
  <meta property="og:url" content="https://emprex291.github.io/">
  <meta property="og:title" content="–ë–ö ¬´–•–æ—Ä—ñ—à–∫–∏¬ª ‚Äî –ê—Ñ—ñ—à–∞ —Ç–∞ –≥—É—Ä—Ç–∫–∏">
  <meta property="og:description" content="–ö—É–ª—å—Ç—É—Ä–Ω—ñ –ø–æ–¥—ñ—ó —Ç–∞ –≥—É—Ä—Ç–∫–∏ —É –•–æ—Ä—ñ—à–∫–∞—Ö.">
  <meta property="og:image" content="https://images.unsplash.com/photo-1540575467063-178a50c2df87?q=80&w=1200&auto=format&fit=crop">
  <meta name="twitter:card" content="summary_large_image">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0b1220; --panel:#0f172a; --text:#e6ecff; --muted:#9fb3d5; --brand:#2151d1; --brand-2:#3aa6ff; --ring:0 0 0 2px rgba(58,166,255,.35), 0 10px 30px rgba(33,81,209,.25);}
    [data-theme="light"]{ --bg:#f5f7ff; --panel:#fff; --text:#0f172a; --muted:#475569; --brand:#2151d1; --brand-2:#3aa6ff; }
    *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--text);}
    a{color:inherit;text-decoration:none} img{max-width:100%;min-width:100%;max-height:100%;min-height:100%;height:auto;display:block} .container{max-width:1100px;margin:0 auto;padding:0 20px}
    header{position:sticky;top:0;z-index:50;background:linear-gradient(180deg, rgba(11,18,32,.9), rgba(11,18,32,.6));backdrop-filter:blur(8px);border-bottom:1px solid rgba(255,255,255,.08);}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:14px 0} .logo{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.3px}
    .logo-badge{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg,var(--brand),var(--brand-2));display:grid;place-items:center;color:#fff;font-weight:800}
    .nav-links{display:flex;gap:16px;align-items:center} .btn{display:inline-flex;align-items:center;gap:10px;border:1px solid rgba(255,255,255,.15);padding:10px 14px;border-radius:12px;transition:.2s;cursor:pointer}
    .btn:hover{transform:translateY(-1px);box-shadow:var(--ring)} .btn.primary{background:linear-gradient(135deg,var(--brand),var(--brand-2));border:0;color:#fff}
    .theme-toggle{border:1px solid rgba(255,255,255,.15);padding:8px 10px;border-radius:10px;cursor:pointer}
    .hero{position:relative;overflow:hidden} .hero .bg{position:absolute;inset:0;background-image:url('https://images.unsplash.com/photo-1540575467063-178a50c2df87?q=80&w=1800&auto=format&fit=crop');background-size:cover;background-position:center;filter:brightness(.55) saturate(1.1);}
    .hero .overlay{position:absolute;inset:0;background:radial-gradient(50% 70% at 50% 20%, rgba(58,166,255,.35), transparent),linear-gradient(180deg, rgba(11,18,32,.0), var(--bg) 85%);}
    .hero .inner{position:relative;padding:96px 0 40px} .headline{font-size:clamp(28px,4vw,46px);line-height:1.1;font-weight:800;letter-spacing:.2px} .sub{color:var(--muted);max-width:720px} .cta{display:flex;gap:12px;margin-top:18px;flex-wrap:wrap}
    section{scroll-margin-top:80px;padding:40px 0} h2{font-size:clamp(22px,3.4vw,30px);margin:0 0 18px 0} .panel{background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px}
    .filters{display:grid;grid-template-columns:1fr 160px 160px auto;gap:10px;margin-bottom:14px} .filters input,.filters select{width:100%;border:1px solid rgba(255,255,255,.15);background:transparent;color:inherit;padding:10px 12px;border-radius:12px;outline:0}
    .filters input:focus,.filters select:focus{box-shadow:var(--ring)} .events,.clubs{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media (max-width:920px){.events,.clubs{grid-template-columns:repeat(2,1fr)}.filters{grid-template-columns:1fr 1fr}}
    @media (max-width:560px){.events,.clubs{grid-template-columns:1fr}.nav-links{display:none}}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.00));border:1px solid rgba(255,255,255,.08);border-radius:16px;overflow:hidden;display:flex;flex-direction:column}
    .card-img{aspect-ratio:16/9;background:#0b1220;overflow:hidden} .card-body{padding:12px} .tag{display:inline-flex;align-items:center;gap:6px;font-size:12px;color:var(--muted);border:1px solid rgba(255,255,255,.15);border-radius:999px;padding:4px 8px}
    .card-actions{display:flex;gap:8px;margin-top:auto;padding:12px} .card-actions .btn{flex:1;justify-content:center}
    .map{border:0;width:100%;height:340px;border-radius:16px} .gallery{display:grid;grid-template-columns:repeat(4,1fr);gap:10px} @media (max-width:800px){.gallery{grid-template-columns:repeat(2,1fr)}}
    .gallery a{border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,.1)} dialog.lightbox{border:0;padding:0;background:rgba(0,0,0,.9);width:100%;height:100%} dialog::backdrop{background:rgba(0,0,0,.85)}
    .lightbox img{max-width:92vw;max-height:86vh;margin:auto;display:block} .note{border:1px dashed rgba(255,255,255,.25);border-radius:12px;padding:10px;margin:10px 0;color:var(--muted)}
    .note.error{border-color:#ff7171;color:#ff9d9d} footer{border-top:1px solid rgba(255,255,255,.08);padding:24px 0;color:var(--muted)}
    :focus-visible{outline:2px solid var(--brand-2);outline-offset:2px} @media (prefers-reduced-motion: reduce){*{animation:none!important;transition:none!important;scroll-behavior:auto!important}}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="logo"><div class="logo-badge">–ë–ö</div> –ë–ö ¬´–•–æ—Ä—ñ—à–∫–∏¬ª</div>
      <nav class="nav-links">
        <a href="#afisha" class="btn">–ê—Ñ—ñ—à–∞</a>
        <a href="#clubs" class="btn">–ì—É—Ä—Ç–∫–∏</a>
        <a href="#contacts" class="btn">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a>
        <a href="#map" class="btn">–õ–æ–∫–∞—Ü—ñ—è</a>
        <button id="themeBtn" class="theme-toggle" aria-label="–ó–º—ñ–Ω–∏—Ç–∏ —Ç–µ–º—É">üåì</button>
        <a class="btn primary" href="#contactForm">–ó–∞–±—Ä–æ–Ω—é–≤–∞—Ç–∏ –∑–∞–ª</a>
      </nav>
    </div>
  </header>

  <section class="hero">
    <div class="bg" aria-hidden="true"></div>
    <div class="overlay"></div>
    <div class="container inner">
      <h1 class="headline">–ü–æ–¥—ñ—ó —Ç–∞ –≥—É—Ä—Ç–∫–∏ –¥–ª—è –≤—Å—ñ—î—ó –≥—Ä–æ–º–∞–¥–∏</h1>
      <p class="sub">–ö–æ–Ω—Ü–µ—Ä—Ç–∏, –∫—ñ–Ω–æ, –≥—É—Ä—Ç–∫–∏ —Ç–∞ —Å–≤—è—Ç–∞. –û–±–∏—Ä–∞–π—Ç–µ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º —Ç–∞ –ø—Ä–∏—Ö–æ–¥—å—Ç–µ –∑ –¥—Ä—É–∑—è–º–∏!</p>
      <div class="cta">
        <a href="#afisha" class="btn primary">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∞—Ñ—ñ—à—É</a>
        <a href="#clubs" class="btn">–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –≥—É—Ä—Ç–∫—ñ–≤</a>
      </div>
    </div>
  </section>

  <section id="afisha">
    <div class="container">
      <h2>–ê—Ñ—ñ—à–∞</h2>
      <div class="panel">
        <div class="filters">
          <input id="qEvents" type="search" placeholder="–ü–æ—à—É–∫ –ø–æ–¥—ñ–π‚Ä¶" aria-label="–ü–æ—à—É–∫">
          <input id="fromEvents" type="date" aria-label="–í—ñ–¥ –¥–∞—Ç–∏">
          <select id="categoryEvents" aria-label="–ö–∞—Ç–µ–≥–æ—Ä—ñ—è">
            <option value="">–£—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</option>
            <option>–ö–æ–Ω—Ü–µ—Ä—Ç</option><option>–ö—ñ–Ω–æ</option><option>–ì—É—Ä—Ç–æ–∫</option><option>–°–≤—è—Ç–æ</option>
          </select>
          <button id="resetEvents" class="btn" type="button">–°–∫–∏–Ω—É—Ç–∏</button>
        </div>
        <div id="events" class="events" role="list"></div>
        <div id="emptyEvents" class="note" style="display:none">–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –ø–æ–¥—ñ–π –∑–∞ –≤–∞—à–∏–º —Ñ—ñ–ª—å—Ç—Ä–æ–º.</div>
        <div id="eventsError" class="note error" style="display:none"></div>
      </div>
    </div>
  </section>

  <section id="clubs">
    <div class="container">
      <h2>–ì—É—Ä—Ç–∫–∏</h2>
      <div class="panel">
        <div class="filters">
          <input id="qClubs" type="search" placeholder="–ü–æ—à—É–∫ –≥—É—Ä—Ç–∫—ñ–≤‚Ä¶" aria-label="–ü–æ—à—É–∫">
          <select id="dayClubs" aria-label="–î–µ–Ω—å —Ç–∏–∂–Ω—è">
            <option value="">–ë—É–¥—å-—è–∫–∏–π –¥–µ–Ω—å</option>
            <option>–ü–Ω</option><option>–í—Ç</option><option>–°—Ä</option><option>–ß—Ç</option><option>–ü—Ç</option><option>–°–±</option><option>–ù–¥</option>
          </select>
          <select id="ageClubs" aria-label="–í—ñ–∫">
            <option value="">–ë—É–¥—å-—è–∫–∏–π –≤—ñ–∫</option>
            <option>–î—ñ—Ç–∏</option><option>–ü—ñ–¥–ª—ñ—Ç–∫–∏</option><option>–î–æ—Ä–æ—Å–ª—ñ</option><option>–£—Å—ñ</option>
          </select>
          <button id="resetClubs" class="btn" type="button">–°–∫–∏–Ω—É—Ç–∏</button>
        </div>
        <div id="clubsList" class="clubs" role="list"></div>
        <div id="emptyClubs" class="note" style="display:none">–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –≥—É—Ä—Ç–∫—ñ–≤ –∑–∞ –≤–∞—à–∏–º —Ñ—ñ–ª—å—Ç—Ä–æ–º.</div>
        <div id="clubsError" class="note error" style="display:none"></div>
      </div>
    </div>
  </section>

  <section id="gallery">
    <div class="container">
      <h2>–ì–∞–ª–µ—Ä–µ—è</h2>
      <div class="gallery">
        <a href="https://images.unsplash.com/photo-1492684223066-81342ee5ff30?q=80&w=1600&auto=format&fit=crop" class="gl">
          <img loading="lazy" decoding="async" alt="–°—Ü–µ–Ω–∞" src="https://images.unsplash.com/photo-1492684223066-81342ee5ff30?q=80&w=600&auto=format&fit=crop" onerror="this.src='https://images.unsplash.com/photo-1511379938547-c1f69419868d?q=80&w=600&auto=format&fit=crop'">
        </a>
        <a href="https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?q=80&w=1600&auto=format&fit=crop" class="gl">
          <img loading="lazy" decoding="async" alt="–ó–∞–ª" src="https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?q=80&w=600&auto=format&fit=crop" onerror="this.src='https://images.unsplash.com/photo-1515165562835-c3b8a954b45a?q=80&w=600&auto=format&fit=crop'">
        </a>
        <a href="https://images.unsplash.com/photo-1483721310020-03333e577078?q=80&w=1600&auto=format&fit=crop" class="gl">
          <img loading="lazy" decoding="async" alt="–°–≤—è—Ç–æ" src="https://images.unsplash.com/photo-1483721310020-03333e577078?q=80&w=600&auto=format&fit=crop" onerror="this.src='https://images.unsplash.com/photo-1464349153735-7db50ed83c84?q=80&w=600&auto=format&fit=crop'">
        </a>
        <a href="https://images.unsplash.com/photo-1521336575822-6da63fb45455?q=80&w=1600&auto=format&fit=crop" class="gl">
          <img loading="lazy" decoding="async" alt="–ì—É—Ä—Ç–æ–∫" src="https://images.unsplash.com/photo-1521336575822-6da63fb45455?q=80&w=600&auto=format&fit=crop" onerror="this.src='https://images.unsplash.com/photo-1529336953121-ad2a0b81f2b0?q=80&w=600&auto=format&fit=crop'">
        </a>
      </div>
    </div>
    <dialog id="lightbox" class="lightbox"><img alt=""><form method="dialog"><button class="btn" style="position:fixed;right:16px;top:16px">–ó–∞–∫—Ä–∏—Ç–∏</button></form></dialog>
  </section>

  <section id="map">
    <div class="container">
      <h2>–î–µ –º–∏ –∑–Ω–∞—Ö–æ–¥–∏–º–æ—Å—å</h2>
      <div class="panel">
        <iframe id="mapFrame" class="map" loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade"></iframe>
        <div style="display:flex;gap:10px;margin-top:10px;flex-wrap:wrap">
          <a class="btn" target="_blank" rel="noopener noreferrer" id="gmDir">–ü—Ä–æ–∫–ª–∞—Å—Ç–∏ –º–∞—Ä—à—Ä—É—Ç</a>
          <a class="btn" target="_blank" rel="noopener noreferrer" id="amDir">–í—ñ–¥–∫—Ä–∏—Ç–∏ –≤ Apple Maps</a>
        </div>
      </div>
    </div>
  </section>

  <section id="contacts">
    <div class="container">
      <h2>–ö–æ–Ω—Ç–∞–∫—Ç–∏ —Ç–∞ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è</h2>
      <div class="panel" id="contactForm">
        <form action="https://formspree.io/f/YOUR_FORMSPREE_ID" method="POST">
          <input type="text" name="_honey" style="display:none">
          <input type="hidden" name="_subject" value="–ó–∞—è–≤–∫–∞ –∑ —Å–∞–π—Ç—É –ë–ö ¬´–•–æ—Ä—ñ—à–∫–∏¬ª">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
            <div>
              <label>–í–∞—à–µ —ñ–º‚Äô—è</label>
              <input name="name" required style="width:100%;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.15);background:transparent;color:inherit">
            </div>
            <div>
              <label>–¢–µ–ª–µ—Ñ–æ–Ω –∞–±–æ email</label>
              <input name="contact" required style="width:100%;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.15);background:transparent;color:inherit">
            </div>
          </div>
          <label style="display:block;margin-top:10px">–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</label>
          <textarea name="message" required rows="4" style="width:100%;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.15);background:transparent;color:inherit"></textarea>
          <div class="cta" style="margin-top:10px">
            <button class="btn primary" type="submit">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
            <a class="btn" href="mailto:dk.horyshky@example.com">–ù–∞–ø–∏—Å–∞—Ç–∏ –Ω–∞ e-mail</a>
            <a class="btn" href="tel:+380000000000">–ü–æ–¥–∑–≤–æ–Ω–∏—Ç–∏</a>
          </div>
        </form>
      </div>
    </div>
  </section>

  <footer>
    <div class="container" style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap">
      <div>¬© <span id="year"></span> –ë–ö ¬´–•–æ—Ä—ñ—à–∫–∏¬ª. –£—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω–æ.</div>
      <div style="display:flex;gap:8px">
        <a class="btn" target="_blank" rel="noopener noreferrer" href="https://t.me/">Telegram</a>
        <a class="btn" target="_blank" rel="noopener noreferrer" href="https://facebook.com/">Facebook</a>
      </div>
    </div>
  </footer>

<script>
/** =====================
  * –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø
  * ===================== */
const CONFIG = {
  // –ü—É–±–ª—ñ—á–Ω—ñ CSV-–ª—ñ–Ω–∫–∏, –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ –∑ —Ç–≤–æ–≥–æ /pubhtml
  EVENTS_PUB_CSV_URL: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ8HWUpRCUDfWqzWFvzGV-oN2RQDZIRrPu3fn2XERUS40gOobu07_C438dwXk-UnbiZgDWc4q365kc2/pub?gid=1962718832&single=true&output=csv",
  CLUBS_PUB_CSV_URL:  "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ8HWUpRCUDfWqzWFvzGV-oN2RQDZIRrPu3fn2XERUS40gOobu07_C438dwXk-UnbiZgDWc4q365kc2/pub?gid=2048496614&single=true&output=csv",

  // Fallback –¥–æ–¥–∞—î—Ç—å—Å—è –ª–∏—à–µ —è–∫—â–æ –±—É–¥–µ –≤–∫–∞–∑–∞–Ω–∏–π –∫–ª–∞—Å–∏—á–Ω–∏–π sheetId
  SHEET_ID: "",
  EVENTS_GID: "1962718832",
  CLUBS_GID:  "2048496614",

  // –ö–∞—Ä—Ç–∞
  MAP_LAT: 49.37223286638658, 
  MAP_LNG: 33.82324957392846,
  MAP_ZOOM: 15,
  PLACE_NAME: "–•–æ—Ä—ñ—à–∫—ñ–≤—Å—å–∫–∏–π —Å—ñ–ª—å—Å—å–∫–∏–π –±—É–¥–∏–Ω–æ–∫ –∫—É–ª—å—Ç—É—Ä–∏"
};

/** =====================
  * –¢–ï–ú–ê
  * ===================== */
const root = document.documentElement;
const savedTheme = localStorage.getItem('theme');
if(savedTheme) root.setAttribute('data-theme', savedTheme);
document.getElementById('themeBtn').addEventListener('click', () => {
  const next = root.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
  root.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
});

/** =====================
  * –õ–ê–ô–¢–ë–û–ö–°
  * ===================== */
const lb = document.getElementById('lightbox');
document.querySelectorAll('.gl').forEach(a=>{
  a.addEventListener('click', e=>{
    e.preventDefault();
    lb.querySelector('img').src = a.href;
    lb.showModal();
  });
});

/** =====================
  * CSV: –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ –∫—ñ–ª—å–∫–æ–º–∞ —Å–ø—Ä–æ–±–∞–º–∏
  * ===================== */
function csvToJson(text){
  const lines = text.replace(/^\uFEFF/, '').split(/\r?\n/).filter(Boolean);
  const head = lines.shift().split(',').map(s=>s.trim());
  return lines.map(l => {
    const cols = []; let cur = '', inQ = false;
    for(let i=0;i<l.length;i++){
      const ch = l[i];
      if(ch === '"'){ inQ = !inQ; continue; }
      if(ch === ',' && !inQ){ cols.push(cur); cur=''; continue; }
      cur += ch;
    }
    cols.push(cur);
    const obj = {};
    head.forEach((h,idx)=>obj[h]= (cols[idx]||'').trim());
    return obj;
  });
}
async function tryFetchCsv(url){
  const res = await fetch(url, {cache:'no-store', redirect:'follow'});
  if(!res.ok) throw new Error('HTTP '+res.status);
  return csvToJson(await res.text());
}
async function loadCSVWithFallback(kind){
  const pub = kind === 'events' ? CONFIG.EVENTS_PUB_CSV_URL : CONFIG.CLUBS_PUB_CSV_URL;
  const gid = kind === 'events' ? CONFIG.EVENTS_GID : CONFIG.CLUBS_GID;
  const candidates = [ pub && pub.trim() ];
  if(CONFIG.SHEET_ID && CONFIG.SHEET_ID.trim()){
    const base = `https://docs.google.com/spreadsheets/d/${CONFIG.SHEET_ID}`;
    candidates.push(`${base}/gviz/tq?tqx=out:csv&gid=${gid}`);
    candidates.push(`${base}/export?format=csv&gid=${gid}`);
  }
  const list = candidates.filter(Boolean);
  let lastErr = null;
  for(const u of list){
    try{ return await tryFetchCsv(u); }catch(e){ lastErr = e; }
  }
  throw lastErr || new Error('CSV failed');
}
function pick(o, names){
  for(const n of names){
    for(const k in o){
      if(k.toLowerCase() === n.toLowerCase()) return o[k];
    }
  } return "";
}
// –ü–æ–¥—ñ—ó
function normalizeEvent(row){
  return {
    Title: pick(row, ['Title','–ù–∞–∑–≤–∞','–ü–æ–¥—ñ—è']),
    Date:  pick(row, ['Date','–î–∞—Ç–∞']),
    Time:  pick(row, ['Time','–ß–∞—Å']),
    Category: pick(row, ['Category','–ö–∞—Ç–µ–≥–æ—Ä—ñ—è','–¢–∏–ø']),
    Description: pick(row, ['Description','–û–ø–∏—Å']),
    Price: pick(row, ['Price','–í–∞—Ä—Ç—ñ—Å—Ç—å','–¶—ñ–Ω–∞','–ö–≤–∏—Ç–æ–∫']),
    Image: pick(row, ['Image','–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è','–§–æ—Ç–æ']),
    Public: pick(row, ['Public','–ü—É–±–ª—ñ—á–Ω–∞','–ü–æ–∫–∞–∑—É–≤–∞—Ç–∏']) || 'TRUE'
  };
}
// –ì—É—Ä—Ç–∫–∏
function normalizeClub(row){
  return {
    Title: pick(row, ['Title','–ù–∞–∑–≤–∞','–ì—É—Ä—Ç–æ–∫']),
    Days:  pick(row, ['Days','–î–Ω—ñ','–†–æ–∑–∫–ª–∞–¥','–î–µ–Ω—å']),
    Time:  pick(row, ['Time','–ß–∞—Å']),
    Age:   pick(row, ['Age','–í—ñ–∫','–ì—Ä—É–ø–∞']),
    Level: pick(row, ['Level','–†—ñ–≤–µ–Ω—å']),
    Description: pick(row, ['Description','–û–ø–∏—Å']),
    Price: pick(row, ['Price','–í–∞—Ä—Ç—ñ—Å—Ç—å','–¶—ñ–Ω–∞']),
    Teacher: pick(row, ['Teacher','–¢—Ä–µ–Ω–µ—Ä','–í–∏–∫–ª–∞–¥–∞—á']),
    Contact: pick(row, ['Contact','–ö–æ–Ω—Ç–∞–∫—Ç','–¢–µ–ª–µ—Ñ–æ–Ω','Email']),
    Image: pick(row, ['Image','–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è','–§–æ—Ç–æ']),
    Public: pick(row, ['Public','–ü—É–±–ª—ñ—á–Ω–∞','–ü–æ–∫–∞–∑—É–≤–∞—Ç–∏']) || 'TRUE'
  };
}
function isPublicFlag(val){
  const s = String(val||'').trim().toLowerCase();
  return s === '' || s === 'true' || s === '1' || s === '—Ç–∞–∫' || s === 'yes';
}

/** =====================
  * –†–ï–ù–î–ï–†: –ê—Ñ—ñ—à–∞
  * ===================== */
function renderEvents(events){
  const q = document.getElementById('qEvents').value.toLowerCase();
  const from = document.getElementById('fromEvents').value ? new Date(document.getElementById('fromEvents').value) : null;
  const cat = document.getElementById('categoryEvents').value;
  const list = document.getElementById('events');
  const empty = document.getElementById('emptyEvents');
  list.innerHTML = '';

  const filtered = events.filter(ev => isPublicFlag(ev.Public)).filter(ev => {
    const text = (ev.Title||'') + ' ' + (ev.Description||'');
    const okQ = !q || text.toLowerCase().includes(q);
    const okC = !cat || (ev.Category||'').toLowerCase() === cat.toLowerCase();
    const d = ev.Date ? new Date(ev.Date) : null;
    const okD = !from || (d && d >= from);
    return okQ && okC && okD;
  }).sort((a,b)=> (a.Date||'').localeCompare(b.Date||''));

  empty.style.display = filtered.length ? 'none' : 'block';

  for(const ev of filtered){
    const img = ev.Image || "https://images.unsplash.com/photo-1492684223066-81342ee5ff30?q=80&w=800&auto=format&fit=crop";
    const date = ev.Date || '';
    const time = ev.Time || '';
    const title = ev.Title || '–ü–æ–¥—ñ—è';
    const category = ev.Category || '–ü–æ–¥—ñ—è';
    const desc = ev.Description || '';
    const price = ev.Price || '';
    const card = document.createElement('article');
    card.className = 'card';
    card.setAttribute('role','listitem');
    card.innerHTML = `
      <div class="card-img"><img loading="lazy" decoding="async" alt="${title}" src="${img}" onerror="this.src='https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=800&auto=format&fit=crop'"></div>
      <div class="card-body">
        <div style="display:flex;justify-content:space-between;gap:8px;align-items:center;margin-bottom:6px">
          <span class="tag">üìÖ ${date}${time? ' ¬∑ '+time:''}</span>
          <span class="tag">üè∑ ${category}</span>
        </div>
        <h3 style="margin:6px 0 8px 0;font-size:18px">${title}</h3>
        <p style="margin:0;color:var(--muted)">${desc}</p>
        ${price? `<p style="margin:8px 0 0 0;color:var(--muted)"><b>–í–∞—Ä—Ç—ñ—Å—Ç—å:</b> ${price}</p>`:''}
      </div>
      <div class="card-actions">
        <button class="btn" type="button">–î–æ–¥–∞—Ç–∏ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä</button>
        <button class="btn" type="button">–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—å</button>
      </div>
    `;
    const [btnIcs, btnShare] = card.querySelectorAll('.btn');
    btnIcs.addEventListener('click', ()=> downloadICS(ev));
    btnShare.addEventListener('click', ()=> shareEvent(ev));
    list.appendChild(card);
  }
}

/** =====================
  * –†–ï–ù–î–ï–†: –ì—É—Ä—Ç–∫–∏
  * ===================== */
function renderClubs(clubs){
  const q = document.getElementById('qClubs').value.toLowerCase();
  const day = document.getElementById('dayClubs').value.toLowerCase();
  const age = document.getElementById('ageClubs').value.toLowerCase();
  const list = document.getElementById('clubsList');
  const empty = document.getElementById('emptyClubs');
  list.innerHTML = '';

  const filtered = clubs.filter(ev => isPublicFlag(ev.Public)).filter(ev => {
    const text = (ev.Title||'') + ' ' + (ev.Description||'') + ' ' + (ev.Teacher||'');
    const okQ = !q || text.toLowerCase().includes(q);
    const okDay = !day || (ev.Days||'').toLowerCase().includes(day);
    const okAge = !str(age) || (ev.Age||'').toLowerCase().includes(age);
    return okQ && okDay && okAge;
  }).sort((a,b)=> (a.Title||'').localeCompare(b.Title||''));

  empty.style.display = filtered.length ? 'none' : 'block';

  for(const c of filtered){
    const img = c.Image || "https://images.unsplash.com/photo-1521336575822-6da63fb45455?q=80&w=800&auto=format&fit=crop";
    const card = document.createElement('article');
    card.className = 'card';
    card.setAttribute('role','listitem');
    card.innerHTML = `
      <div class="card-img"><img loading="lazy" decoding="async" alt="${c.Title||'–ì—É—Ä—Ç–æ–∫'}" src="${img}" onerror="this.src='https://images.unsplash.com/photo-1529336953121-ad2a0b81f2b0?q=80&w=800&auto=format&fit=crop'"></div>
      <div class="card-body">
        <div style="display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:6px">
          ${c.Days? `<span class="tag">üìÖ ${c.Days}</span>`:''}
          ${c.Time? `<span class="tag">‚è∞ ${c.Time}</span>`:''}
          ${c.Age? `<span class="tag">üë• ${c.Age}</span>`:''}
          ${c.Level? `<span class="tag">‚≠ê ${c.Level}</span>`:''}
        </div>
        <h3 style="margin:6px 0 8px 0;font-size:18px">${c.Title||'–ì—É—Ä—Ç–æ–∫'}</h3>
        ${c.Teacher? `<p style="margin:0;color:var(--muted)"><b>–ö–µ—Ä—ñ–≤–Ω–∏–∫:</b> ${c.Teacher}</p>`:''}
        <p style="margin:6px 0 0 0;color:var(--muted)">${c.Description||''}</p>
        ${c.Price? `<p style="margin:8px 0 0 0;color:var(--muted)"><b>–í–∞—Ä—Ç—ñ—Å—Ç—å:</b> ${c.Price}</p>`:''}
        ${c.Contact? `<p style="margin:8px 0 0 0;color:var(--muted)"><b>–ö–æ–Ω—Ç–∞–∫—Ç:</b> ${c.Contact}</p>`:''}
      </div>
    `;
    list.appendChild(card);
  }
}
function str(s){ return String(s||'').trim(); }

/** =====================
  * ICS + Share
  * ===================== */
function pad(n){ return String(n).padStart(2,'0'); }
function toICSDate(dateStr, timeStr){
  const d = new Date((dateStr||'') + (timeStr? 'T'+timeStr : 'T09:00'));
  return d.getFullYear()+pad(d.getMonth()+1)+pad(d.getDate())+'T'+pad(d.getHours())+pad(d.getMinutes())+'00';
}
function downloadICS(ev){
  const dtstart = toICSDate(ev.Date, ev.Time);
  const dtend = toICSDate(ev.Date, ev.Time ? ev.Time : "10:30");
  const uid = Date.now()+'@dk-horyshky';
  const ics = ['BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//DK Horyshky//UA',
    'BEGIN:VEVENT','UID:'+uid,'DTSTAMP:'+dtstart,'DTSTART:'+dtstart,'DTEND:'+dtend,
    'SUMMARY:'+ (ev.Title||'–ü–æ–¥—ñ—è'),'DESCRIPTION:'+ (ev.Description||''),'LOCATION:'+ CONFIG.PLACE_NAME,'END:VEVENT','END:VCALENDAR'].join('\r\n');
  const blob = new Blob([ics], {type:'text/calendar;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'event.ics'; document.body.appendChild(a); a.click();
  setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 1000);
}
async function shareEvent(ev){
  const text = `${ev.Title||'–ü–æ–¥—ñ—è'} ‚Äî ${ev.Date||''} ${ev.Time||''} —É ${CONFIG.PLACE_NAME}.`;
  const shareData = { title: '–ë–ö ¬´–•–æ—Ä—ñ—à–∫–∏¬ª', text, url: location.href+'#afisha' };
  if(navigator.share){ try{ await navigator.share(shareData); }catch{} }
  else{ await navigator.clipboard.writeText(shareData.url + "\n" + text); alert('–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!'); }
}

/** =====================
  * –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø –î–ê–ù–ò–•
  * ===================== */
async function initData(){
  try { const rows = await loadCSVWithFallback('events'); const events = rows.map(normalizeEvent); window.__events = events; renderEvents(events); }
  catch(e){ const box = document.getElementById('eventsError'); box.style.display='block'; box.textContent='–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ê—Ñ—ñ—à—É. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ /pub?output=csv –¥–æ—Å—Ç—É–ø–Ω–∏–π.'; console.warn('Events CSV failed', e); }
  try { const rows = await loadCSVWithFallback('clubs'); const clubs = rows.map(normalizeClub); window.__clubs = clubs; renderClubs(clubs); }
  catch(e){ const box = document.getElementById('clubsError'); box.style.display='block'; box.textContent='–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ì—É—Ä—Ç–∫–∏. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ /pub?output=csv –¥–æ—Å—Ç—É–ø–Ω–∏–π.'; console.warn('Clubs CSV failed', e); }
}

/** =====================
  * –§–Ü–õ–¨–¢–†–ò
  * ===================== */
['qEvents','fromEvents','categoryEvents'].forEach(id => document.getElementById(id).addEventListener('input', ()=> renderEvents(window.__events||[])));
document.getElementById('resetEvents').addEventListener('click', ()=>{ document.getElementById('qEvents').value=''; document.getElementById('fromEvents').value=''; document.getElementById('categoryEvents').value=''; renderEvents(window.__events||[]); });
['qClubs','dayClubs','ageClubs'].forEach(id => document.getElementById(id).addEventListener('input', ()=> renderClubs(window.__clubs||[])));
document.getElementById('resetClubs').addEventListener('click', ()=>{ document.getElementById('qClubs').value=''; document.getElementById('dayClubs').value=''; document.getElementById('ageClubs').value=''; renderClubs(window.__clubs||[]); });

/** =====================
  * –ö–ê–†–¢–ê
  * ===================== */
function mapEmbedSrc(lat,lng,zoom){ const q = encodeURIComponent(lat+','+lng); return `https://www.google.com/maps?q=${q}&z=${zoom||15}&hl=uk&output=embed`; }
function updateMap(){ const {MAP_LAT, MAP_LNG, MAP_ZOOM, PLACE_NAME} = CONFIG;
  document.getElementById('mapFrame').src = mapEmbedSrc(MAP_LAT, MAP_LNG, MAP_ZOOM);
  document.getElementById('gmDir').href = `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(PLACE_NAME)}%20@${MAP_LAT},${MAP_LNG}`;
  document.getElementById('amDir').href = `https://maps.apple.com/?q=${encodeURIComponent(PLACE_NAME)}&ll=${MAP_LAT},${MAP_LNG}&z=${MAP_ZOOM}`; }

/** =====================
  * SERVICE WORKER + INIT
  * ===================== */
if('serviceWorker' in navigator){ navigator.serviceWorker.register('service-worker.js').catch(()=>{}); }
document.getElementById('year').textContent = new Date().getFullYear();
updateMap(); initData();
</script>
</body>
</html>
